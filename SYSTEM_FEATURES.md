# 川輝科技分潤管理系統 - 完整功能說明

## 系統概述

川輝科技分潤管理系統是一個全功能的專案收付款與分潤管理平台，專為解決複雜的專案財務管理需求而設計。系統整合了專案管理、收付款追蹤、分潤計算、自動撥款、勞務報酬單生成等完整功能，讓您可以在一個平台上管理所有專案的財務流程。

### 為什麼需要這個系統？

**傳統問題**：
- 專案收付款記錄分散在不同系統
- 分潤計算需要手動處理，容易出錯
- 勞務報酬單需要手動製作
- 不同頁面資料不同步，造成混亂
- 財務資料缺乏即時性和透明度

**我們的解決方案**：
- **統一平台**：所有財務操作在同一系統完成
- **自動計算**：系統自動處理分潤計算和稅務
- **即時同步**：所有頁面資料完全同步
- **一鍵操作**：收款、撥款、報表生成都是一鍵完成
- **完整追蹤**：從簽約到收款到撥款的完整記錄

## 系統架構說明

### 核心設計原則：專案管理為中心

本系統採用「專案管理為唯一數據來源」的架構設計：

```
專案管理（主操作頁面）
    ↓ 提供數據
分潤管理（統計顯示）+ 付款記錄（統計顯示）
```

- **專案管理頁面** = 所有收付款、撥款操作的實際執行地點
- **分潤管理頁面** = 從專案管理統計各專案的分潤情況
- **付款記錄頁面** = 從專案管理統計各專案的收付款情況
- **數據同步保證** = 三個頁面永遠顯示相同的資料

## 主要功能模組

### 1. 專案管理 (`/projects/[id]`) - 系統核心操作頁面

這是整個系統最重要的頁面，所有的實際操作都在這裡進行。一個專案的完整生命週期管理都在這個頁面完成。

#### 📋 專案基本資訊管理

**功能說明**：完整的專案資料管理，包含合約資訊、財務設定、時程規劃等。

**具體功能**：
- **專案基本資料編輯**：
  - 專案名稱、客戶名稱、專案描述
  - 專案金額（不含稅）- 系統自動計算含稅金額
  - 專案類型選擇：一般專案 / 續約專案
  - 業務負責人指派
  - 簽約日期設定

- **專案編號自動生成**：
  - 格式：`{公司統編}-{簽約日期YYYYMMDD}`
  - 例如：`12345678-20240115`
  - **重新生成功能**：編輯專案時可點擊「重新生成專案編號」按鈕

- **分潤比例設定**：
  - 選項1：使用固定分潤比例（可自訂百分比）
  - 選項2：使用系統預設（一般專案35%、續約專案15%）
  - 系統會根據設定自動計算所有分潤相關金額

**操作流程**：
1. 點擊頁面上方的「編輯專案」按鈕
2. 修改需要的欄位
3. 如需重新生成專案編號，點擊「重新生成專案編號」
4. 點擊「儲存」完成更新

#### 💰 期數付款管理系統

**功能說明**：最重要的收款管理功能，支援複雜的分期付款模式，每筆收款都會完整記錄。

**付款模板支援**：
- **預設模板**：`3/3/2/2`（30%/30%/20%/20%）、`6/4`（60%/40%）、`10`（100%一次付清）
- **自訂模板**：可以設定任意比例，如 `2/2/3/3`、`5/3/2` 等
- **彈性調整**：每期金額可以根據實際情況微調

**期數操作功能**：

**📥 收款登記**：
- **操作位置**：每一期的「標記已付款」按鈕
- **記錄內容**：
  - 實際收款金額（可與預設金額不同）
  - 收款日期（預設今天，可修改）
  - 付款方式（轉帳/支票/現金等）
- **自動計算**：系統自動計算含稅金額（+5%營業稅）

**📊 付款狀態追蹤**：
- **未付款**：顯示橘色「未付款」標籤
- **已付款**：顯示綠色「已付款」標籤 + 收款日期
- **進度條**：頁面上方顯示整體收款進度
- **金額統計**：即時顯示已收金額和待收金額

**🔄 期數重新生成**：
- **使用時機**：專案金額或付款模板變更時
- **操作方式**：點擊「重新生成期數」按鈕
- **保留資料**：已收款的期數資料會保留
- **重新計算**：未收款期數會重新計算金額

#### 💸 分潤撥款操作系統

**功能說明**：這是系統的核心功能，當收到客戶款項後，可以立即進行分潤撥款操作。

**撥款操作流程**：

**步驟1：收款確認**
- 在期數管理表格中標記該期為「已付款」
- 輸入實際收款金額和日期

**步驟2：執行撥款**
- 點擊該期的「撥款」按鈕
- 系統自動計算撥款金額：
  ```
  撥款金額 = 實際收款金額 × 分潤比例
  例：收款 100,000 × 35% = 撥款 35,000
  ```

**步驟3：自動化處理**
- **撥款記錄**：系統自動記錄撥款日期、金額、期數
- **勞務報酬單生成**：自動產生PDF格式的勞務報酬單
- **狀態更新**：撥款狀態更新為「已撥款」

**撥款記錄詳情**：
- **撥款日期**：實際撥款日期
- **撥款金額**：精確到小數點後兩位
- **撥款基準**：顯示基於哪一期收款進行撥款
- **撥款比例**：顯示適用的分潤百分比
- **相關文件**：勞務報酬單PDF下載連結

#### 📊 成本管理系統

**功能說明**：完整的專案成本追蹤，支援預期成本和實際成本管理。

**成本類型**：
- **人力成本**：內部人員工時成本
- **外包成本**：外部廠商費用
- **設備成本**：硬體、軟體採購
- **其他成本**：交通、材料等雜項費用

**成本狀態管理**：
- **待支出**：已規劃但尚未支付的成本
- **已支出**：已實際支付的成本
- **成本變更**：可隨時調整成本狀態和金額

**成本操作**：
- **新增成本**：點擊「新增成本」按鈕
- **編輯成本**：修改成本項目、金額、狀態
- **刪除成本**：移除不需要的成本項目
- **成本統計**：自動計算總成本和支出比例

#### 🔧 維護資訊管理

**功能說明**：專案交付後的維護期管理，包含維護排程和費用管理。

**維護資訊設定**：
- **實際完工日期**：專案實際完成日期
- **維護開始日期**：維護期開始日期
- **維護計費日期**：開始收取維護費用的日期
- **維護費用**：每期維護費用金額

**狀態提示功能**：
- **填寫狀態**：清楚顯示哪些維護資訊已填寫
- **提示文字**：顯示目前填寫的值，如「已填寫：2024/01/15」
- **更新按鈕**：統一的「更新維護資訊」按鈕

**操作流程**：
1. 專案完工後，填寫「實際完工日期」
2. 設定維護期開始日期和計費日期
3. 設定維護費用金額
4. 點擊「更新維護資訊」儲存

#### 📈 即時財務統計儀表板

**功能說明**：專案財務狀況的即時總覽，所有關鍵數字一目了然。

**收款統計區塊**：
- **已收金額**：已實際收到的總金額
- **待收金額**：尚未收到的金額
- **收款進度**：百分比進度條 + 視覺化圖表
- **收款效率**：平均收款週期分析

**成本統計區塊**（僅Admin和Finance可見）：
- **已支出成本**：已實際支付的成本總額
- **待支出成本**：預計但尚未支付的成本
- **總成本**：所有成本項目的總和
- **成本控制**：成本占專案金額的比例

**預期利潤計算**（僅Admin和Finance可見）：
```
預期利潤 = 專案總額 - 應有分潤總額 - 已支出成本 - 待支出成本
利潤率 = 預期利潤 ÷ 專案總額 × 100%
```
- **即時計算**：數字會隨著收款、撥款、成本變動即時更新
- **顏色提示**：獲利顯示綠色，虧損顯示紅色
- **利潤率分析**：顯示利潤占專案金額的百分比

**分潤總覽區塊**（僅Admin和Finance可見）：
- **分潤比例**：顯示該專案適用的分潤百分比
- **分潤總額**：根據專案金額和比例計算的總分潤額度
- **已撥金額**：已實際撥付的分潤總和
- **待撥金額**：尚未撥付的分潤金額
- **撥款狀態**：
  - 「已全額撥款」（綠色）
  - 「待撥 XX%」（橘色）
  - 進度條顯示撥款完成度

### 2. 分潤管理 (`/commissions`) - 分潤統計總覽頁面

**功能定位**：這是一個純統計顯示頁面，所有資料都來自專案管理頁面的實際撥款記錄。讓管理者可以快速了解所有專案的分潤狀況。

#### 📊 分潤統計總覽表格

**功能說明**：以表格形式展示所有專案的分潤統計，每一行代表一個專案的分潤摘要。

**表格欄位詳解**：

| 欄位名稱 | 說明 | 計算方式 |
|---------|------|----------|
| **專案編號** | 可點擊的專案連結 | 點擊可直接跳轉到專案管理頁面 |
| **客戶名稱** | 專案客戶名稱 | 從專案基本資料取得 |
| **業務員** | 負責的業務人員 | 從專案指派資料取得 |
| **專案金額** | 專案總金額（不含稅） | 專案合約金額 |
| **分潤%** | 適用的分潤比例 | 固定分潤 或 預設比例（35%/15%） |
| **總分潤** | 該專案的分潤總額度 | 專案金額 × 分潤比例 |
| **已撥款** | 已實際撥付的金額 | 從專案管理撥款記錄統計 |
| **待撥款** | 尚未撥付的金額 | 總分潤 - 已撥款 |
| **撥款進度** | 撥款完成百分比 | (已撥款 ÷ 總分潤) × 100% |
| **建立時間** | 專案建立日期 | 專案創建時間 |

**特殊功能**：
- **顏色標示**：
  - 已撥款金額：綠色顯示
  - 待撥款金額：紅色顯示
  - 撥款進度100%：綠色進度條
  - 撥款進度未完成：藍色進度條

- **操作按鈕**：
  - **查看專案**：跳轉到專案管理頁面
  - **部分撥款**：快速查看撥款明細

#### 📈 撥款進度視覺化

**進度條顯示**：
- **完整進度條**：顯示撥款完成度
- **百分比標示**：精確到小數點後一位
- **狀態區分**：
  - 0%：未開始撥款（灰色）
  - 1-99%：部分撥款（藍色）
  - 100%：完全撥款（綠色）

#### 🔍 快速篩選和搜尋

**篩選功能**（未來擴展）：
- **按業務員篩選**：只顯示特定業務的專案
- **按撥款狀態篩選**：已完成/進行中/未開始
- **按專案類型篩選**：一般專案/續約專案
- **按時間範圍篩選**：特定期間的專案

#### 📋 撥款明細追蹤

**明細資訊**：每個專案可以展開查看詳細的撥款記錄
- **撥款日期**：每次撥款的實際日期
- **撥款金額**：每次撥款的具體金額
- **期數對應**：該撥款對應的收款期數
- **撥款比例**：該次撥款適用的分潤比例
- **累計撥款**：到該次為止的累計撥款金額

**數據來源**：所有資料都即時從專案管理頁面的 `project_installments` 表格同步，確保100%準確。

### 3. 付款記錄管理 (`/payments`) - 收款統計與明細頁面

**功能定位**：這是收款狀況的統計總覽頁面，提供跨專案的收款分析和明細查詢。所有資料都來自專案管理頁面的實際收款記錄。

#### 📊 專案收款進度總覽

**功能說明**：以卡片形式展示各專案的收款進度，提供直觀的視覺化收款狀況。

**進度卡片功能**：
- **專案基本資訊**：
  - 專案編號（可點擊跳轉）
  - 客戶名稱
  - 專案總額
  
- **收款進度視覺化**：
  - **進度條**：顯示收款完成度
  - **百分比**：收款百分比（精確到小數點）
  - **金額對比**：已收金額 / 專案總額
  - **顏色區分**：
    - 收款完成：綠色進度條
    - 收款進行中：藍色進度條
    - 未開始收款：灰色進度條

**卡片佈局**：
- **響應式設計**：自動適應不同螢幕尺寸
- **最多顯示6個**：首頁顯示最近的6個專案
- **快速概覽**：一眼就能看出收款狀況

#### 📋 收款明細記錄表格

**功能說明**：完整的收款明細表格，顯示所有來自專案管理的實際收款記錄。

**表格欄位說明**：

| 欄位名稱 | 內容說明 | 資料來源 |
|---------|----------|----------|
| **付款日期** | 實際收到款項的日期 | 專案管理中的收款登記 |
| **專案編號** | 可點擊的專案連結 | 跳轉到對應專案管理頁面 |
| **客戶名稱** | 付款的客戶名稱 | 專案基本資料 |
| **付款金額** | 實際收到的金額 | 期數實際收款金額 |
| **付款方式** | 收款方式 | 轉帳/支票/現金/信用卡 |
| **專案總額** | 該專案的合約總金額 | 專案基本資料 |
| **付款模板** | 該專案的付款期數設定 | 如：3/3/2/2、6/4等 |

**表格特色功能**：
- **即時同步**：與專案管理頁面的收款記錄100%同步
- **期數描述**：顯示「第X期付款」說明
- **金額格式化**：自動加上千分位符號
- **日期格式**：台灣地區日期格式
- **專案連結**：點擊專案編號直接跳轉

#### 📥 收款登記功能

**功能說明**：提供快速收款登記的介面，登記後會自動同步到專案管理。

**登記表單欄位**：
- **專案選擇**：下拉選單選擇專案
  - 顯示格式：`專案編號 - 客戶名稱 (已收XX% / NT$ XXX)`
  - 智慧提示：顯示當前收款狀況
  
- **付款日期**：
  - 預設今天日期
  - 可手動調整為實際收款日期
  
- **收款金額**：
  - 支援小數點輸入
  - 自動格式化顯示
  
- **付款方式**：
  - 轉帳（預設）
  - 支票
  - 現金  
  - 信用卡

**操作流程**：
1. 點擊「登錄收款」按鈕
2. 選擇對應專案（會顯示目前收款狀況）
3. 輸入實際收款金額和日期
4. 選擇付款方式
5. 點擊「確認登錄」完成

**自動化處理**：
- **同步到專案管理**：收款記錄會立即同步到專案管理頁面
- **期數更新**：自動更新對應期數的付款狀態
- **進度重算**：重新計算專案收款進度
- **通知提醒**：可設定收款通知（未來功能）

#### 📈 收款統計分析

**統計卡片**（頁面頂部）：
- **今日收款**：今天的收款總額
- **本月收款**：當月累計收款
- **平均收款週期**：從期數到期到實際收款的平均天數
- **收款效率**：準時收款的專案比例

**進階分析**（未來擴展）：
- **收款趨勢圖**：月度收款趨勢
- **客戶收款分析**：不同客戶的收款模式
- **期數收款統計**：第幾期收款最困難
- **逾期收款提醒**：超過預定收款日期的提醒

### 4. 勞務報酬單系統 - 自動化文件生成

**功能定位**：完全自動化的勞務報酬單生成系統，當執行撥款時自動產生符合稅務規範的正式文件。

#### 📄 自動生成機制

**觸發條件**：
- **撥款執行時**：在專案管理頁面點擊「撥款」按鈕時自動觸發
- **一鍵完成**：無需額外操作，系統自動處理所有流程
- **即時生成**：撥款完成後立即產生PDF文件

**生成流程**：
1. **撥款執行** → 系統記錄撥款資訊
2. **資料收集** → 自動收集專案、業務員、撥款相關資料
3. **稅務計算** → 自動計算扣繳稅額和實際給付金額
4. **PDF生成** → 產生標準格式的勞務報酬單
5. **檔案儲存** → 儲存到系統中供隨時下載

#### 📋 報酬單內容規格

**文件格式**：標準A4 PDF格式，符合稅務機關要求

**包含資訊**：
- **報酬單編號**：系統自動編號
- **給付日期**：實際撥款日期
- **業務人員資料**：
  - 姓名、身份證號
  - 地址資訊
  - 聯絡電話、Email
- **專案資訊**：
  - 專案名稱、專案編號
  - 客戶名稱
  - 期數說明（第X期撥款）
- **金額明細**：
  - 撥款基準金額（收款金額）
  - 分潤比例
  - 應給付金額
  - 扣繳稅額
  - 實際給付金額
- **稅務資訊**：
  - 扣繳類別
  - 所得性質
  - 扣繳稅率

#### 💾 檔案管理系統

**儲存機制**：
- **自動命名**：格式 `勞務報酬單_{專案編號}_{期數}_{日期}.pdf`
- **分類儲存**：按專案和年度分類儲存
- **版本控制**：同一期數重複撥款會產生新版本

**下載功能**：
- **專案管理頁面**：每筆撥款記錄都有下載連結
- **批次下載**：可選擇多個報酬單一次下載
- **歷史查詢**：可查詢和下載歷史報酬單

### 5. 使用者權限管理系統

**功能定位**：完善的角色權限控制，確保不同職級的使用者只能存取適當的功能和資料。

#### 👥 角色分類與權限

**管理員 (Admin)**：
- **完整系統權限**：所有功能都可使用
- **所有專案存取**：可查看和操作所有專案
- **使用者管理**：可新增、編輯、刪除使用者
- **系統設定**：可修改系統參數和設定
- **財務完整權限**：可查看所有財務資料

**財務人員 (Finance)**：
- **財務資料查看**：可查看成本、利潤、分潤等財務資訊
- **專案財務管理**：可操作收款、撥款等財務功能
- **報表權限**：可產生和下載各種財務報表
- **勞務報酬單**：可查看和下載所有勞務報酬單
- **無系統管理權限**：無法管理使用者和系統設定

**業務人員 (Sales)**：
- **自己專案權限**：只能查看自己負責的專案
- **基本操作權限**：可查看專案基本資訊和收款狀況
- **無財務敏感資料**：無法查看成本、利潤等財務細節
- **無撥款權限**：無法執行分潤撥款操作
- **自己的勞務報酬單**：只能查看自己的勞務報酬單

**主管 (Leader)**：
- **團隊專案權限**：可查看自己和下屬負責的專案
- **部分財務權限**：可查看基本財務資訊但不含敏感資料
- **審核權限**：可審核下屬的專案和撥款申請
- **團隊報表**：可產生團隊相關的統計報表

#### 🔒 權限控制機制

**頁面存取控制**：
- **登入驗證**：所有頁面都需要登入才能存取
- **角色檢查**：根據使用者角色顯示對應功能
- **功能隱藏**：無權限的功能自動隱藏或顯示為禁用

**資料存取控制**：
- **資料篩選**：根據角色自動篩選可見的資料
- **API權限**：後端API也有對應的權限檢查
- **敏感資料保護**：財務敏感資料只對特定角色開放

**操作權限控制**：
- **功能按鈕**：根據權限顯示或隱藏操作按鈕
- **表單權限**：不同角色可編輯的欄位不同
- **審批流程**：重要操作需要對應權限的審批

### 6. 數據同步與一致性保證

**功能定位**：系統最重要的設計特色，確保所有頁面的資料完全同步，消除傳統系統常見的資料不一致問題。

#### 🎯 統一數據源架構

**核心設計原則**：
```
單一真相來源 (Single Source of Truth)
專案管理 (project_installments) = 主數據源
    ↓ 即時計算
分潤管理 + 付款記錄 = 統計顯示頁面
```

**實作方式**：
- **主表格**：`project_installments` 儲存所有收款和撥款記錄
- **計算型欄位**：其他頁面的數據都是從主表格即時計算
- **無重複儲存**：不在多個地方儲存相同的資料
- **即時更新**：主數據異動時，所有相關頁面立即更新

#### ⚡ 即時同步機制

**同步保證**：
- **收款記錄**：在專案管理登記收款 → 付款記錄頁面立即顯示
- **撥款記錄**：在專案管理執行撥款 → 分潤管理頁面立即更新
- **統計數據**：任何金額異動 → 所有統計數字立即重算
- **進度更新**：狀態變更 → 所有進度條立即更新

**技術實現**：
- **統一資料庫視圖**：使用資料庫視圖統一計算邏輯
- **前端即時查詢**：頁面載入時即時查詢最新資料
- **無快取資料**：避免使用可能過期的快取資料
- **事務完整性**：確保資料異動的原子性

#### 🔍 資料一致性驗證

**自動檢查機制**：
- **數據對比**：定期檢查各頁面顯示的資料是否一致
- **邏輯驗證**：檢查計算邏輯是否正確
- **異常偵測**：偵測可能的資料異常並提醒
- **修復機制**：提供資料修復工具

**人工確認點**：
- **重要操作前**：執行撥款前確認相關數據
- **定期檢查**：定期檢查關鍵數據的一致性
- **報表核對**：定期產生報表進行人工核對

## 系統特色與優勢

### 🚀 1. 革命性的操作體驗

**一站式完整管理**：
- **所有操作集中在專案管理頁面**：從專案建立、收款登記、撥款執行到成本管理，全部在一個頁面完成
- **零學習成本的直觀介面**：每個按鈕都有清楚的說明，新使用者可以立即上手
- **智慧提示系統**：系統會提示下一步該做什麼，避免遺漏重要操作
- **一鍵自動化流程**：點擊撥款按鈕，系統自動完成計算、記錄、勞務報酬單生成等所有後續流程

**消除重複作業**：
- **告別Excel管理**：不再需要維護複雜的Excel試算表
- **自動同步更新**：一次輸入，所有相關頁面自動更新
- **減少90%的手動計算**：分潤金額、稅務計算、進度統計全部自動化

### 🎯 2. 數據準確性保證

**零誤差的計算系統**：
- **統一數據源設計**：徹底解決傳統系統常見的「不同頁面數字不一樣」問題
- **即時同步機制**：專案管理頁面一有異動，分潤管理和付款記錄立即同步
- **自動驗證機制**：系統自動檢查數據邏輯，防止不合理的數據輸入
- **版本一致性**：所有使用者看到的數據都是同一個版本，不會有時間差

**智慧防錯機制**：
- **輸入驗證**：防止輸入負數、超過專案金額的異常數據
- **邏輯檢查**：檢查撥款金額是否合理、期數是否正確等
- **操作確認**：重要操作前會顯示確認對話框
- **操作記錄**：完整記錄誰在什麼時候做了什麼操作

### 💰 3. 完整的財務透明度

**360度財務追蹤**：
- **收款全程追蹤**：從簽約、開發票、收款到入帳的完整流程
- **撥款完整記錄**：每一筆撥款都有完整的依據和計算過程
- **成本精確控管**：區分已支出和待支出成本，即時掌握專案獲利
- **利潤即時計算**：隨時知道每個專案的實際獲利情況

**專業級報表系統**：
- **勞務報酬單自動生成**：符合稅務規範的正式文件
- **多維度統計分析**：按專案、按業務員、按時間的各種統計
- **視覺化圖表**：進度條、圓餅圖等直觀的數據呈現
- **匯出功能**：支援Excel、PDF等格式的報表匯出

### 🔐 4. 企業級安全與權限

**細緻的權限控制**：
- **角色化權限管理**：Admin、Finance、Sales、Leader四種角色
- **資料存取控制**：業務只能看自己的專案，財務可看所有財務資料
- **功能權限分離**：不同角色可使用的功能不同
- **敏感資料保護**：成本、利潤等敏感資料只對授權人員開放

**資料安全保障**：
- **完整的操作記錄**：誰在什麼時候做了什麼都有記錄
- **資料備份機制**：定期自動備份，防止資料遺失
- **版本控制**：重要文件如勞務報酬單都有版本控制
- **存取日誌**：記錄所有資料存取行為

### ⚡ 5. 高效能與擴展性

**技術優勢**：
- **現代化架構**：採用Next.js + Supabase的現代技術棧
- **雲端部署**：隨時隨地存取，不受地點限制
- **自動擴展**：系統可根據使用量自動調整效能
- **即時響應**：所有操作都是即時反應，無需等待

**未來擴展性**：
- **模組化設計**：可輕鬆新增新功能模組
- **API介面**：可與其他系統整合
- **客製化彈性**：可根據需求調整功能和介面
- **多語系支援**：未來可支援多國語言

## 🏗️ 技術架構詳解

### 前端架構
```
使用者介面層 (UI Layer)
    ↓
React.js 組件系統
    ↓
Next.js 應用框架
    ↓
Supabase JavaScript Client
    ↓
RESTful API 通訊
```

**技術選型說明**：
- **Next.js**：React框架，提供服務端渲染和靜態生成
- **React Hooks**：現代化的狀態管理和生命週期管理
- **響應式設計**：支援桌面、平板、手機各種裝置
- **PWA支援**：可安裝為桌面應用，提供類原生App體驗

### 後端架構
```
Supabase Platform
    ↓
PostgreSQL 資料庫
    ↓
Row Level Security (RLS)
    ↓
Real-time Subscriptions
```

**技術特色**：
- **Supabase**：現代化的後端即服務平台
- **PostgreSQL**：企業級關聯式資料庫
- **即時同步**：支援多使用者即時協作
- **自動備份**：雲端自動備份機制

### 資料庫設計

**核心資料表**：
- **projects**：專案基本資訊表
- **project_installments**：期數收付款主表（系統核心）
- **project_costs**：專案成本表
- **users**：使用者資訊表
- **labor_receipts**：勞務報酬單記錄表

**視圖設計**：
- **commission_summary**：分潤統計視圖
- **payment_commission_summary**：付款收款統計視圖
- **project_financial_summary**：專案財務總覽視圖

## 📋 完整使用指南

### 🏁 系統導入流程

**第一階段：基礎設定（1天）**
1. **使用者帳號建立**：建立Admin、Finance、業務人員帳號
2. **權限設定**：設定各角色的存取權限
3. **基本資料匯入**：匯入現有的專案和客戶資料
4. **系統測試**：測試各項基本功能

**第二階段：歷史資料遷移（2-3天）**
1. **專案資料整理**：整理現有專案的完整資料
2. **收款記錄匯入**：匯入已有的收款記錄
3. **撥款記錄匯入**：匯入已執行的撥款記錄
4. **數據驗證**：確認匯入資料的正確性

**第三階段：教育訓練（1天）**
1. **管理層訓練**：Admin和Finance功能介紹
2. **業務團隊訓練**：專案管理和基本操作
3. **實際操作練習**：使用測試資料進行操作練習
4. **問題解答**：解答使用過程中的疑問

### 📝 日常作業流程

**新專案建立流程**：
1. **專案基本資料建立**
   - 登入系統 → 專案管理 → 新增專案
   - 填寫專案名稱、客戶名稱、專案金額
   - 設定分潤比例（固定比例或使用預設）
   - 選擇付款模板（3/3/2/2、6/4等）

2. **期數設定與確認**
   - 系統自動產生期數
   - 確認各期金額和到期日
   - 如需調整可手動修改

3. **專案編號生成**
   - 系統自動生成格式：統編-簽約日期
   - 如需重新生成可點擊重新生成按鈕

**收款處理流程**：
1. **收到客戶款項**
   - 進入對應專案頁面
   - 找到對應期數，點擊「標記已付款」
   - 輸入實際收款金額和日期
   - 選擇付款方式，確認儲存

2. **確認收款狀態**
   - 檢查該期狀態已變更為「已付款」
   - 確認頁面上方收款進度已更新
   - 檢查付款記錄頁面是否已同步顯示

**撥款處理流程**：
1. **執行撥款操作**
   - 在已收款的期數點擊「撥款」按鈕
   - 確認撥款金額計算正確
   - 點擊確認執行撥款

2. **後續自動處理**
   - 系統自動記錄撥款資訊
   - 自動生成勞務報酬單PDF
   - 更新分潤管理頁面統計
   - 發送撥款完成通知（如有設定）

**成本管理流程**：
1. **成本登記**
   - 在專案頁面點擊「新增成本」
   - 選擇成本類型和填寫金額
   - 設定成本狀態（待支出/已支出）
   - 儲存成本項目

2. **成本更新**
   - 實際支出時更新成本狀態
   - 如有金額變動可修改成本金額
   - 系統自動重算預期利潤

### 🔧 系統維護建議

**日常維護（每日）**：
- **資料備份確認**：確認自動備份正常運作
- **使用者存取檢查**：檢查是否有異常的存取行為
- **系統效能監控**：確認系統回應速度正常

**週期性維護（每月）**：
- **資料一致性檢查**：確認各頁面數據一致
- **使用者權限檢查**：確認權限設定符合需求
- **勞務報酬單檔案整理**：整理和歸檔PDF文件

**定期檢查（每季）**：
- **財務數據核對**：與會計系統核對關鍵數字
- **系統功能測試**：測試各項功能是否正常
- **使用者滿意度調查**：收集使用者回饋意見

**年度維護**：
- **系統升級規劃**：規劃新功能和改善項目
- **資料歸檔作業**：歸檔舊年度的歷史資料
- **安全性檢查**：全面檢查系統安全性

## 🎯 成功導入的關鍵要素

### 👥 人員準備
- **指派專案負責人**：負責統籌導入過程
- **關鍵使用者訓練**：培養系統專家協助其他使用者
- **變更管理**：協助團隊適應新的作業流程

### 📊 資料準備
- **資料清理**：確保原始資料的完整性和正確性
- **格式統一**：統一資料格式便於匯入
- **測試資料**：準備測試用的假資料進行練習

### 🔄 流程設計
- **標準作業程序**：制定標準的操作流程
- **權責劃分**：明確各角色的職責範圍
- **異常處理**：建立異常狀況的處理機制

---

## 📞 支援與聯絡

**技術支援**：
- 系統操作問題：內部IT部門
- 功能改善建議：專案負責人統籌收集

**文件資源**：
- 本功能說明書：完整功能介紹
- 快速操作指南：常用功能的簡化說明
- 常見問題Q&A：使用過程中的常見問題

---

*川輝科技分潤管理系統 - 讓財務管理變得簡單高效*

*本系統由 Claude Code 協助開發，採用現代化技術架構，提供企業級的穩定性和安全性。*